<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="This report of statistical findings summarizes results for the classification of ovarian cancer histotypes.">

<title>2&nbsp; Methods – Ovarian Cancer Histotypes: Report of Statistical Findings</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../rsf/distributions.html" rel="next">
<link href="../rsf/introduction.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="../site_libs/viz-1.8.2/viz.js"></script>
<link href="../site_libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="../site_libs/grViz-binding-1.0.11/grViz.js"></script>
<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../rsf/methods.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Methods</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Ovarian Cancer Histotypes: Report of Statistical Findings</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/TalhoukLab/OV_Histotypes" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="../Ovarian-Cancer-Histotypes--Report-of-Statistical-Findings.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rsf/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rsf/methods.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rsf/distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Distributions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rsf/results.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Results</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rsf/references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#pre-processing" id="toc-pre-processing" class="nav-link active" data-scroll-target="#pre-processing"><span class="header-section-number">2.1</span> Pre-Processing</a>
  <ul class="collapse">
  <li><a href="#case-selection" id="toc-case-selection" class="nav-link" data-scroll-target="#case-selection"><span class="header-section-number">2.1.1</span> Case Selection</a></li>
  <li><a href="#quality-control" id="toc-quality-control" class="nav-link" data-scroll-target="#quality-control"><span class="header-section-number">2.1.2</span> Quality Control</a></li>
  <li><a href="#normalization" id="toc-normalization" class="nav-link" data-scroll-target="#normalization"><span class="header-section-number">2.1.3</span> Normalization</a></li>
  <li><a href="#final-processing" id="toc-final-processing" class="nav-link" data-scroll-target="#final-processing"><span class="header-section-number">2.1.4</span> Final Processing</a></li>
  </ul></li>
  <li><a href="#classifiers" id="toc-classifiers" class="nav-link" data-scroll-target="#classifiers"><span class="header-section-number">2.2</span> Classifiers</a>
  <ul class="collapse">
  <li><a href="#resampling-of-training-set" id="toc-resampling-of-training-set" class="nav-link" data-scroll-target="#resampling-of-training-set"><span class="header-section-number">2.2.1</span> Resampling of Training Set</a></li>
  <li><a href="#hyperparameter-tuning" id="toc-hyperparameter-tuning" class="nav-link" data-scroll-target="#hyperparameter-tuning"><span class="header-section-number">2.2.2</span> Hyperparameter Tuning</a></li>
  <li><a href="#subsampling" id="toc-subsampling" class="nav-link" data-scroll-target="#subsampling"><span class="header-section-number">2.2.3</span> Subsampling</a></li>
  <li><a href="#workflows" id="toc-workflows" class="nav-link" data-scroll-target="#workflows"><span class="header-section-number">2.2.4</span> Workflows</a></li>
  </ul></li>
  <li><a href="#two-step-algorithm" id="toc-two-step-algorithm" class="nav-link" data-scroll-target="#two-step-algorithm"><span class="header-section-number">2.3</span> Two-Step Algorithm</a>
  <ul class="collapse">
  <li><a href="#aggregating-predictions" id="toc-aggregating-predictions" class="nav-link" data-scroll-target="#aggregating-predictions"><span class="header-section-number">2.3.1</span> Aggregating Predictions</a></li>
  </ul></li>
  <li><a href="#sequential-algorithm" id="toc-sequential-algorithm" class="nav-link" data-scroll-target="#sequential-algorithm"><span class="header-section-number">2.4</span> Sequential Algorithm</a>
  <ul class="collapse">
  <li><a href="#aggregating-predictions-1" id="toc-aggregating-predictions-1" class="nav-link" data-scroll-target="#aggregating-predictions-1"><span class="header-section-number">2.4.1</span> Aggregating Predictions</a></li>
  </ul></li>
  <li><a href="#gene-optimization" id="toc-gene-optimization" class="nav-link" data-scroll-target="#gene-optimization"><span class="header-section-number">2.5</span> Gene Optimization</a>
  <ul class="collapse">
  <li><a href="#variable-importance" id="toc-variable-importance" class="nav-link" data-scroll-target="#variable-importance"><span class="header-section-number">2.5.1</span> Variable Importance</a></li>
  </ul></li>
  <li><a href="#performance-evaluation" id="toc-performance-evaluation" class="nav-link" data-scroll-target="#performance-evaluation"><span class="header-section-number">2.6</span> Performance Evaluation</a>
  <ul class="collapse">
  <li><a href="#class-metrics" id="toc-class-metrics" class="nav-link" data-scroll-target="#class-metrics"><span class="header-section-number">2.6.1</span> Class Metrics</a></li>
  <li><a href="#auc" id="toc-auc" class="nav-link" data-scroll-target="#auc"><span class="header-section-number">2.6.2</span> AUC</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TalhoukLab/OV_Histotypes/edit/main/rsf/methods.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TalhoukLab/OV_Histotypes/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Methods</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="pre-processing" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="pre-processing"><span class="header-section-number">2.1</span> Pre-Processing</h2>
<section id="case-selection" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="case-selection"><span class="header-section-number">2.1.1</span> Case Selection</h3>
<p>Raw data comes from three NanoString CodeSets (CS): CS1, CS2, and CS3. We divide the data into training, confirmation, and validation sets by using samples from these sets of cohorts:</p>
<ul>
<li>Training
<ul>
<li>CS1: MAYO, OOU, OOUE, VOA, MTL</li>
<li>CS2: MAYO, OOU, OOUE, OVAR3, VOA, ICON7, JAPAN, MTL, POOL-CTRL</li>
<li>CS3: OOU, OOUE, VOA, POOL-1, POOL-2, POOL-3</li>
</ul></li>
<li>Confirmation:
<ul>
<li>CS3: TNCO</li>
</ul></li>
<li>Validation:
<ul>
<li>CS3: DOVE4</li>
</ul></li>
</ul>
</section>
<section id="quality-control" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="quality-control"><span class="header-section-number">2.1.2</span> Quality Control</h3>
<p>Samples that failed any of the following NanoString quality control conditions were removed:</p>
<ul>
<li><code>linFlag</code>: linearity of positive controls with positive control concentrations is less than 0.95, or linearity measures are unknown</li>
<li><code>imagingFlag</code>: percent of field of view is less than 75%</li>
<li><code>spcFlag</code>: smallest positive control is less than the lower limit of detection (negative control average expression less two times the negative control standard deviation), or negative control average expression equals zero</li>
<li><code>normFlag</code>: signal to noise ratio less than 100, or percent of genes detected is less than 50. Note: these thresholds were determined by examining the [%GD vs.&nbsp;SNR] relationship below.</li>
</ul>
</section>
<section id="normalization" class="level3" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="normalization"><span class="header-section-number">2.1.3</span> Normalization</h3>
<p>The full training set (n=1243) is comprised of data from CodeSets (CS) 1, 2, and 3. All CodeSets were first normalized to housekeeping genes, then different approaches were taken for subsequent normalizations of each CodeSet.</p>
<p>CS1 was normalized to CS3 using five “Random1” reference samples. These reference samples are randomly selected from CS1 among all samples in the three CodeSets that share common otta IDs, such that we obtain one sample from each of the five histotypes. Then, we use the reference-based method to normalize CS1 to CS3 across their common genes, for the remaining expression samples <span class="citation" data-cites="talhouk2016">Talhouk et al. (<a href="references.html#ref-talhouk2016" role="doc-biblioref">2016</a>)</span>.</p>
<p>Similarly, CS2 was normalized to CS3 using the same “Random1” reference samples, now taken from CS2. Normalization was performed across common genes between CS2 and CS3.</p>
<p>For CS3, we first split the dataset into three sites: Vancouver, USC, and AOC. We use the CS3-Vancouver subset as a “reference standard”, and normalized CS3-USC and CS3-AOC to CS3-Vancouver using a “Random1” reference set randomly selected among samples common between Vancouver, USC, and AOC. Finally, the CS3-Vancouver expression samples are included in the training set without further normalization.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-venn-genes" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-venn-genes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="methods_files/figure-html/fig-venn-genes-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-venn-genes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.1: Venn diagram of common and unique gene targets covered by each CodeSet
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="final-processing" class="level3" data-number="2.1.4">
<h3 data-number="2.1.4" class="anchored" data-anchor-id="final-processing"><span class="header-section-number">2.1.4</span> Final Processing</h3>
<p>We map ovarian histotypes to all remaining samples and keep the major histotypes for building the predictive model: high-grade serous carcinoma (HGSC), clear cell ovarian carcinoma (CCOC), endometrioid ovarian carcinoma (ENOC), low-grade serous carcinoma (LGSC), mucinous carcinoma (MUC).</p>
<p>Duplicate cases (two samples with the same ottaID) were removed before generating the final training set to use for fitting the classification models. All CS3 cases were preferred over CS1 and CS2, and CS3-Vancouver cases were preferred over CS3-AOC and CS3-USC when selecting duplicates.</p>
<p>The final training set used only genes that were common across all three CodeSets.</p>
<div class="cell">
<div id="fig-processing" class="cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-processing-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="grViz html-widget html-fill-item" id="htmlwidget-a3a9c5b06c7f37c729f1" style="width:100%;height:3000px;"></div>
<script type="application/json" data-for="htmlwidget-a3a9c5b06c7f37c729f1">{"x":{"diagram":"digraph processing {\n\n    # layout\n    # fontname = \"times-italic\"\n    graph [layout = dot, overlap = FALSE, ranksep = \"0.1\"]\n\n    # node definitions\n    node [shape = box, style = \"filled, rounded\", color = \"white\", fillcolor = \"white\"]\n\n    MAYO [label = \"MAYO\nn = 69\", color = \"black\"]\n    OOU [label = \"OOU\nn = 170\", color = \"black\"]\n    OOUE [label = \"OOUE\nn = 73\", color = \"black\"]\n    VOA [label = \"VOA\nn = 805\", color = \"black\"]\n    MTL [label = \"MTL\nn = 62\", color = \"black\"]\n    OVAR3 [label = \"OVAR3\nn = 150\", color = \"black\"]\n    ICON7 [label = \"ICON7\nn = 416\", color = \"black\"]\n    JAPAN [label = \"JAPAN\nn = 8\", color = \"black\"]\n    intermediate_1 [shape = point, width = 0.01, height = 0.01]\n    train_1 [label = \"n = 1753\", style = \"filled\", fillcolor = \"grey90\"]\n    train_2 [label = \"Training Cohort\nn = 1722\", style = \"filled\", fillcolor = \"#7BB369\"]\n    train_3 [label = \"n = 1640\", style = \"filled\", fillcolor = \"grey90\"]\n    train_cs1 [label = \"CS1\nNx = 244\nNr = 5\", fillcolor = \"#607C8E\"]\n    train_cs2 [label = \"CS2\nNx = 779\nNr = 5\", fillcolor = \"#FFA756\"]\n    train_cs3 [label = \"CS3\nNx = 468\nNr = 5\", fillcolor = \"#259FED\"]\n    train_5 [label = \"Training Cohort\nn = 1243\", style = \"filled\", fillcolor = \"#7BB369\"]\n\n    conf1 [label = \"TNCO\nn = 691\", color = \"black\"]\n    conf2 [label = \"Confirmation\nCohort\nn = 690\", style = \"filled\", fillcolor = \"#B19CD7\"]\n    conf3 [label = \"Confirmation\nCohort\nn = 660\", style = \"filled\", fillcolor = \"#B19CD7\"]\n    conf4 [label = \"Confirmation\nCohort\nn = 643\", style = \"filled\", fillcolor = \"#B19CD7\"]\n\n    val1 [label = \"DOVE4\nn = 1160\", color = \"black\"]\n    val2 [label = \"Validation\nCohort\nn = 959\", style = \"filled\", fillcolor = \"#04D9FF\"]\n    val3 [label = \"Validation\nCohort\nn = 929\", style = \"filled\", fillcolor = \"#04D9FF\"]\n    val4 [label = \"Validation\nCohort\nn = 894\", style = \"filled\", fillcolor = \"#04D9FF\"]\n\n    # edge definitions\n    edge [minlen = 4, arrowsize = 0.75]\n    {MAYO OOU OOUE VOA MTL OVAR3 ICON7 JAPAN} -> intermediate_1 [dir = none]\n    intermediate_1 -> train_1\n    train_1 -> train_2 [xlabel = \"Exclude QC Fails: 31\"]\n    train_2 -> train_3 [xlabel = \"Exclude Other Histotypes: 82\"]\n    train_3 -> {train_cs1 train_cs2 train_cs3} [style = invis, minlen = 1]\n    train_cs1 -> train_5 [xlabel = \"Exclude Duplicates: 248\"]\n    {train_cs2 train_cs3} -> train_5\n\n    conf1 -> conf2 [xlabel = \"Exclude QC\nFails: 1\"]\n    conf2 -> conf3 [xlabel = \"Exclude Other\nHistotypes: 30\"]\n    conf3 -> conf4 [xlabel = \"Exclude\nDuplicates: 17\", minlen = 7]\n\n    val1 -> val2 [xlabel = \"Exclude QC\nFails: 201\"]\n    val2 -> val3 [xlabel = \"Exclude Other\nHistotypes: 30\"]\n    val3 -> val4 [xlabel = \"Exclude\nDuplicates: 35\", minlen = 7]\n\n    # subgraph definitions\n    subgraph {rank = same; MAYO; OOU; OOUE; VOA; MTL; OVAR3; ICON7; JAPAN; conf1; val1}\n    subgraph {rank = same; train_2; conf2; val2}\n    subgraph {rank = same; train_cs1; train_cs2; train_cs3; conf3; val3}\n    subgraph {rank = same; train_5; conf4; val4}\n    }\n    ","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-processing-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.2: Cohorts Selection
</figcaption>
</figure>
</div>
</div>
</section>
</section>
<section id="classifiers" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="classifiers"><span class="header-section-number">2.2</span> Classifiers</h2>
<p>We use 4 classification algorithms in the supervised learning framework for the Training Set. The pipeline was run using SLURM batch jobs submitted to a partition on a CentOS 7 server. All resampling techniques, pre-processing, model specification, hyperparameter tuning, and evaluation metrics were implemented using the <code>tidymodels</code> suite of packages. The classifiers we used are:</p>
<ul>
<li>Random Forest (<code>rf</code>)</li>
<li>Support Vector Machine (<code>svm</code>)</li>
<li>XGBoost (<code>xgb</code>)</li>
<li>Regularized Multinomial Regression (<code>mr</code>)</li>
</ul>
<section id="resampling-of-training-set" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="resampling-of-training-set"><span class="header-section-number">2.2.1</span> Resampling of Training Set</h3>
<p>We used a nested cross-validation design to assess each classifier while also performing hyperparameter tuning. An outer 5-fold CV stratified by histotype was used together with an inner 5-fold CV with 2 repeats stratified by histotype. This design was chosen such that the test sets of the inner resamples would still have a reasonable number of samples belonging to the smallest minority class.</p>
<p>The outer resampling method cannot be the bootstrap, because the inner training and inner test sets will likely contain the same samples as a result of sampling with replacement in the outer training set. This phenomenon might result in inflated performance as some observations are used both to train and evaluate the hyperparameter tuning in the inner loop.</p>
</section>
<section id="hyperparameter-tuning" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="hyperparameter-tuning"><span class="header-section-number">2.2.2</span> Hyperparameter Tuning</h3>
<p>The following specifications for each classifier were used for tuning hyperparameters:</p>
<ul>
<li><code>rf</code> and <code>xgb</code>: The number of trees were fixed at 500. Other hyperparameters were tuned across 10 randomly selected points in a latin hypercube design.</li>
<li><code>svm</code>: Both the cost and sigma hyperparameters were tuned across 10 randomly selected points in a latin hypercube design. We tuned the cost parameter in the range [1, 8]. The range for tuning the sigma parameter was obtained from the 10% and 90% quantiles of the estimation using the <code>kernlab::sigest()</code> function.</li>
<li><code>mr</code>: We generated 10 randomly selected points in a latin hypercube design for the penalty (lambda) parameter. Then, we generated 10 evenly spaced points in [0, 1] for the mixture (alpha) parameter in the regularized multinomial regression model. These two sets of 10 points were crossed to generate a tuning grid of 100 points.</li>
</ul>
<p>The hyperparameter combination that resulted in the highest average F1-score across the inner training sets was selected for each classifier to use as the model for assessing prediction performance in the outer training loop.</p>
</section>
<section id="subsampling" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="subsampling"><span class="header-section-number">2.2.3</span> Subsampling</h3>
<p>Here are the specifications of the subsampling methods used to handle class imbalance:</p>
<ul>
<li>None: No subsampling is performed</li>
<li>Down-sampling: All levels except the minority class are sampled down to the same frequency as the minority class</li>
<li>Up-sampling: All levels except the majority class are sampled up to the same frequency as the majority class</li>
<li>SMOTE: All levels except the majority class have synthetic data generated until they have the same frequency as the majority class</li>
<li>Hybrid: All levels except the majority class have synthetic data generated up to 50% of the frequency of the majority class, then the majority class is sampled down to the same frequency as the rest.</li>
</ul>
<p>The figure below helps visualize how the distribution of classes changes when we apply subsampling techniques to handle class imbalance:</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-sampling" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sampling-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="methods_files/figure-html/fig-sampling-1.png" class="img-fluid figure-img" width="2100">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sampling-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.3: Visualization of Subsampling Techniques
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="workflows" class="level3" data-number="2.2.4">
<h3 data-number="2.2.4" class="anchored" data-anchor-id="workflows"><span class="header-section-number">2.2.4</span> Workflows</h3>
<p>The 4 <strong>algorithms</strong> and 5 <strong>subsampling</strong> methods are crossed to create 20 different classification <strong>workflows</strong>. For example, the <code>hybrid_xgb</code> workflow is a classifier that first pre-processes a training set by applying a hybrid subsampling method, and then proceeds to use the XGBoost algorithm to classify ovarian histotypes.</p>
</section>
</section>
<section id="two-step-algorithm" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="two-step-algorithm"><span class="header-section-number">2.3</span> Two-Step Algorithm</h2>
<p>The HGSC histotype comprises of approximately 80% of cases among ovarian carcinoma patients, while the remaining 20% of cases are relatively, evenly distributed among ENOC, CCOC, LGSC, and MUC histotypes. We can implement a two-step algorithm as such:</p>
<ul>
<li>Step 1: use binary classification for HGSC vs.&nbsp;non-HGSC</li>
<li>Step 2: use multinomial classification for the remaining non-HGSC classes</li>
</ul>
<p>Let</p>
<p><span id="eq-sequential"><span class="math display">\[
\begin{aligned}
&amp; X_k = \text{Training data with k classes}  \\
&amp; C_k = \text{Class with highest}\;F_1\;\text{score from training}\;X_k \\
&amp; W_k = \text{Workflow associated with}\;C_k
\end{aligned}
\tag{2.1}\]</span></span></p>
<p><a href="#fig-two-step-flowchart" class="quarto-xref">Figure&nbsp;<span>2.4</span></a> shows how the two-step algorithm works:</p>
<div class="cell">
<div id="fig-two-step-flowchart" class="cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-two-step-flowchart-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="grViz html-widget html-fill-item" id="htmlwidget-4ff51c61ef82415c77e7" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-4ff51c61ef82415c77e7">{"x":{"diagram":"digraph sequential_algorithm {\n\n    # layout\n    graph [layout = dot overlap = TRUE]\n\n    # node definitions\n    node [fontname = Helvetica, shape = box]\n    a [label = <X<FONT POINT-SIZE=\"8\"><SUB>5<\/SUB><\/FONT>>]\n    b1 [label = \"Store HGSC predictions\"]\n    b2 [label = <Select W<FONT POINT-SIZE=\"8\"><SUB>5<\/SUB><\/FONT> for HGSC>]\n    c [label = <X<FONT POINT-SIZE=\"8\"><SUB>4<\/SUB><\/FONT>>]\n    d1 [label = \"Store remaining predictions\"]\n    d2 [label = \"Select best workflow with highest overall F1-score\"]\n\n    # edge definitions\n    a -> b1 [xlabel = <  Train HGSC vs. all using W<FONT POINT-SIZE=\"8\"><SUB>5<\/SUB><\/FONT>>]\n    a -> b2 [label = \"Train multinomial classes\"]\n\n    b1 -> c [xlabel = <  Remove HGSC cases from X<FONT POINT-SIZE=\"8\"><SUB>5<\/SUB><\/FONT>>]\n    c -> d1 [xlabel = \"Train multinomial classes with best workflow\"]\n    c -> d2 [label = \"Retrain multinomial classes\"]\n\n    j [label = \"Aggregate all predictions\"]\n\n    {b1 d1} -> j\n\n    # subgraph definitions\n    subgraph {rank = same; b1; b2}\n    subgraph {rank = same; d1; d2}\n    }","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-two-step-flowchart-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.4: Two-Step Algorithm
</figcaption>
</figure>
</div>
</div>
<section id="aggregating-predictions" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="aggregating-predictions"><span class="header-section-number">2.3.1</span> Aggregating Predictions</h3>
<p>The aggregation for two-step predictions is quite straightforward:</p>
<ol type="1">
<li>Predict HGSC vs.&nbsp;non-HGSC</li>
<li>Among all non-HGSC cases, predict CCOC vs.&nbsp;LGSC vs.&nbsp;MUC vs.&nbsp;ENOC</li>
</ol>
<div class="cell">
<div id="fig-two-step-predictions" class="cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-two-step-predictions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="grViz html-widget html-fill-item" id="htmlwidget-83714dcd4bafae4d06d3" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-83714dcd4bafae4d06d3">{"x":{"diagram":"digraph two_step_predictions {\n    \n    # layout\n    graph [layout = dot overlap = TRUE]\n\n    # node definitions\n    node [fontname = Helvetica, shape = box]\n    \n    a [label = \"Predict HGSC vs. non-HGSC\"]\n    b1 [label = \"HGSC\"]\n    b2 [label = \"non-HGSC\"]\n    c [label = \"Predict CCOC vs. LGSC vs. MUC vs. ENOC\"]\n    d1 [label = \"CCOC\"]\n    f1 [label = \"LGSC\"]\n    h1 [label = \"MUC\"]\n    h2 [label = \"ENOC\"]\n    \n    # edge definitions\n    a -> {b1 b2}\n    b2 -> c\n    c -> {d1 f1 h1 h2}\n    \n     # subgraph definitions\n    subgraph {rank = same; b2; c}\n    }","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-two-step-predictions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.5: Aggregating Predictions for Two-Step Algorithm
</figcaption>
</figure>
</div>
</div>
</section>
</section>
<section id="sequential-algorithm" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="sequential-algorithm"><span class="header-section-number">2.4</span> Sequential Algorithm</h2>
<p>Instead of training on k classes simultaneously using multinomial classifiers, we can use a sequential algorithm that performs k-1 one-vs-all binary classifications iteratively to obtain a final prediction of all cases. At each step in the sequence, we classify one class vs.&nbsp;all other classes, where the classes that make up the “other” class are those not equal to the current “one” class and excluding all “one” classes from previous steps. For example, if the “one” class in step 1 was HGSC, the “other” classes would include CCOC, ENOC, LGSC, and MUC. If the “one” class in step 2 was CCOC, the “other” classes include ENOC, LGSC, and MUC.</p>
<p>The order of classes and workflows to use at each step in the sequential algorithm must be determined using a retraining procedure. After removing the data associated with a particular class, we retrain using the remaining data using multinomial classifiers as described before. The class and workflow to use for the next step in the sequence is selected based on the best per-class evaluation metric value (e.g.&nbsp;F1-score).</p>
<p><a href="#fig-sequential-flowchart" class="quarto-xref">Figure&nbsp;<span>2.6</span></a> illustrates how the sequential algorithm works for K=5, using ovarian histotypes as an example for the classes.</p>
<div class="cell">
<div id="fig-sequential-flowchart" class="cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sequential-flowchart-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="grViz html-widget html-fill-item" id="htmlwidget-11f3d433af2b7af55189" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-11f3d433af2b7af55189">{"x":{"diagram":"digraph sequential_algorithm {\n\n    # layout\n    graph [layout = dot overlap = TRUE]\n\n    # node definitions\n    node [fontname = Helvetica, shape = box]\n    a [label = <X<FONT POINT-SIZE=\"8\"><SUB>5<\/SUB><\/FONT>>]\n    b1 [label = <Store X<FONT POINT-SIZE=\"8\"><SUB>5<\/SUB><\/FONT>  predictions>]\n    b2 [label = <Select W<FONT POINT-SIZE=\"8\"><SUB>5<\/SUB><\/FONT>  and C<FONT POINT-SIZE=\"8\"><SUB>5<\/SUB><\/FONT>>]\n    c [label = <X<FONT POINT-SIZE=\"8\"><SUB>4<\/SUB><\/FONT>>]\n    d1 [label = <Store X<FONT POINT-SIZE=\"8\"><SUB>4<\/SUB><\/FONT>  predictions>]\n    d2 [label = <Select W<FONT POINT-SIZE=\"8\"><SUB>4<\/SUB><\/FONT>  and C<FONT POINT-SIZE=\"8\"><SUB>4<\/SUB><\/FONT>>]\n    f [label = <X<FONT POINT-SIZE=\"8\"><SUB>3<\/SUB><\/FONT>>]\n    g1 [label = <Store X<FONT POINT-SIZE=\"8\"><SUB>3<\/SUB><\/FONT>  predictions>]\n    g2 [label = <Select W<FONT POINT-SIZE=\"8\"><SUB>3<\/SUB><\/FONT>  and C<FONT POINT-SIZE=\"8\"><SUB>3<\/SUB><\/FONT>>]\n    h [label = <X<FONT POINT-SIZE=\"8\"><SUB>2<\/SUB><\/FONT>>]\n    i1 [label = <Store X<FONT POINT-SIZE=\"8\"><SUB>2<\/SUB><\/FONT>  predictions>]\n    i2 [label = <Select W<FONT POINT-SIZE=\"8\"><SUB>2<\/SUB><\/FONT>  and C<FONT POINT-SIZE=\"8\"><SUB>2<\/SUB><\/FONT>>]\n    j [label = \"Aggregate all predictions\"]\n\n    # edge definitions\n    a -> b1 [xlabel = <  Train C<FONT POINT-SIZE=\"8\"><SUB>5<\/SUB><\/FONT>  vs. all using W<FONT POINT-SIZE=\"8\"><SUB>5<\/SUB><\/FONT>>]\n    a -> b2 [label = \"Train multinomial classes\"]\n    #b2 -> b1\n    b1 -> c [label = <  Remove C<FONT POINT-SIZE=\"8\"><SUB>5<\/SUB><\/FONT>  cases from X<FONT POINT-SIZE=\"8\"><SUB>5<\/SUB><\/FONT>>]\n    c -> d1 [xlabel = <  Train C<FONT POINT-SIZE=\"8\"><SUB>4<\/SUB><\/FONT>  vs. all using W<FONT POINT-SIZE=\"8\"><SUB>4<\/SUB><\/FONT>>]\n    c -> d2 [label = \"Retrain multinomial classes\"]\n    #d2 -> d1\n    d1 -> f [label = <  Remove C<FONT POINT-SIZE=\"8\"><SUB>4<\/SUB><\/FONT>  cases from X<FONT POINT-SIZE=\"8\"><SUB>4<\/SUB><\/FONT>>]\n    f -> g1 [xlabel = <  Train C<FONT POINT-SIZE=\"8\"><SUB>3<\/SUB><\/FONT>  vs. all using W<FONT POINT-SIZE=\"8\"><SUB>3<\/SUB><\/FONT>>]\n    f -> g2 [label = \"Retrain multinomial classes\"]\n    #g2 -> g1\n    g1 -> h [label = <  Remove C<FONT POINT-SIZE=\"8\"><SUB>3<\/SUB><\/FONT>  cases from X<FONT POINT-SIZE=\"8\"><SUB>3<\/SUB><\/FONT>>]\n    h -> i1 [xlabel = <  Train C<FONT POINT-SIZE=\"8\"><SUB>2<\/SUB><\/FONT>  vs. all using W<FONT POINT-SIZE=\"8\"><SUB>2<\/SUB><\/FONT>>]\n    h -> i2 [label = \"Retrain multinomial classes\"]\n\n    {b1 d1 g1 i1} -> j\n\n    # subgraph definitions\n    subgraph {rank = same; b1; b2}\n    subgraph {rank = same; d1; d2}\n    subgraph {rank = same; g1; g2}\n    subgraph {rank = same; i1; i2}\n    subgraph {rank = same; }\n    }","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sequential-flowchart-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.6: Sequential Algorithm
</figcaption>
</figure>
</div>
</div>
<p>The subsampling method used in the first step of the sequential algorithm is used in all subsequent steps in order to maintain data pre-processing consistency. As a result, we are only comparing classification algorithms within one subsampling method across the entire sequential algorithm.</p>
<section id="aggregating-predictions-1" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="aggregating-predictions-1"><span class="header-section-number">2.4.1</span> Aggregating Predictions</h3>
<p>We have to aggregate the one-vs-all predictions from each of the sequential algorithm workflows in order to obtain a final class prediction on a holdout test set. Each sequential workflow has to be assessed on every sample to ensure that cases classified into the “all” class from a previous step of the sequence are eventually assigned a predicted class. For example, say that based on certain class-specific metrics we determined that the order of classes in the sequential algorithm was to predict HGSC vs.&nbsp;non-HGSC, CCOC vs.&nbsp;non-CCOC, LGSC vs.&nbsp;non-LGSC, and then MUC vs.&nbsp;ENOC. <a href="#fig-sequential-predictions" class="quarto-xref">Figure&nbsp;<span>2.7</span></a> illustrates how the final predictions are assigned:</p>
<div class="cell">
<div id="fig-sequential-predictions" class="cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sequential-predictions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="grViz html-widget html-fill-item" id="htmlwidget-5e456e2acc1f7b578cff" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-5e456e2acc1f7b578cff">{"x":{"diagram":"digraph sequential_predictions {\n    \n    # layout\n    graph [layout = dot overlap = TRUE]\n\n    # node definitions\n    node [fontname = Helvetica, shape = box]\n    \n    a [label = \"Predicted HGSC vs. non-HGSC\"]\n    b1 [label = \"HGSC\"]\n    b2 [label = \"non-HGSC\"]\n    c [label = \"Predicted CCOC vs. non-CCOC\"]\n    d1 [label = \"CCOC\"]\n    d2 [label = \"non-CCOC\"]\n    e [label = \"Predicted LGSC vs. non-LGSC\"]\n    f1 [label = \"LGSC\"]\n    f2 [label = \"non-LGSC\"]\n    g [label = \"Predicted MUC vs. ENOC\"]\n    h1 [label = \"MUC\"]\n    h2 [label = \"ENOC\"]\n    \n    # edge definitions\n    a -> {b1 b2}\n    b2 -> c\n    c -> {d1 d2}\n    d2 -> e\n    e -> {f1 f2}\n    f2 -> g\n    g -> {h1 h2}\n    \n     # subgraph definitions\n    subgraph {rank = same; b2; c}\n    subgraph {rank = same; d2; e}\n    subgraph {rank = same; f2; g}\n    }","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sequential-predictions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.7: Aggregating Predictions for Sequential Algorithm
</figcaption>
</figure>
</div>
</div>
</section>
</section>
<section id="gene-optimization" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="gene-optimization"><span class="header-section-number">2.5</span> Gene Optimization</h2>
<p>We want to discover an optimal set of genes for the classifiers while including specific genes from other studies such as PrOTYPE and SPOT. A total of 72 genes are used in the classifier training set.</p>
<p>There are 16 genes in the classifier set that overlap with the PrOTYPE classifier: COL11A1, CD74, CD2, TIMP3, LUM, CYTIP, COL3A1, THBS2, TCF7L1, HMGA2, FN1, POSTN, COL1A2, COL5A2, PDZK1IP1, FBN1.</p>
<p>There are also 13 genes in the classifier set that overlap with the SPOT signature: HIF1A, CXCL10, DUSP4, SOX17, MITF, CDKN3, BRCA2, CEACAM5, ANXA4, SERPINE1, TCF7L1, CRABP2, DNAJC9.</p>
<p>We obtain a total of 28 genes from the union of PrOTYPE and SPOT genes that we want to include in the final classifier, regardless of model performance. We then incrementally add genes one at a time from the remaining 44 candidate genes based on an overall variable importance rank to the set of 28 base genes and recalculate performance metrics. The number of genes at which the performance peaks or starts to plateau may indicate an optimal gene set model for us to compare with the full set model.</p>
<p>Here is the breakdown of genes used and whether they belong to the PrOTYPE and/or SPOT sets:</p>
<div class="cell">
<div id="tbl-gene-dist" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-gene-dist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.1: Gene Distribution
</figcaption>
<div aria-describedby="tbl-gene-dist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> Genes </th>
   <th style="text-align:left;"> PrOTYPE </th>
   <th style="text-align:left;"> SPOT </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> TCF7L1 </td>
   <td style="text-align:left;"> ✔ </td>
   <td style="text-align:left;"> ✔ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> COL11A1 </td>
   <td style="text-align:left;"> ✔ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> CD74 </td>
   <td style="text-align:left;"> ✔ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> CD2 </td>
   <td style="text-align:left;"> ✔ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> TIMP3 </td>
   <td style="text-align:left;"> ✔ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LUM </td>
   <td style="text-align:left;"> ✔ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> CYTIP </td>
   <td style="text-align:left;"> ✔ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> COL3A1 </td>
   <td style="text-align:left;"> ✔ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> THBS2 </td>
   <td style="text-align:left;"> ✔ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> HMGA2 </td>
   <td style="text-align:left;"> ✔ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> FN1 </td>
   <td style="text-align:left;"> ✔ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> POSTN </td>
   <td style="text-align:left;"> ✔ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> COL1A2 </td>
   <td style="text-align:left;"> ✔ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> COL5A2 </td>
   <td style="text-align:left;"> ✔ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> PDZK1IP1 </td>
   <td style="text-align:left;"> ✔ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> FBN1 </td>
   <td style="text-align:left;"> ✔ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> HIF1A </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;"> ✔ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> CXCL10 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;"> ✔ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> DUSP4 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;"> ✔ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> SOX17 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;"> ✔ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> MITF </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;"> ✔ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> CDKN3 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;"> ✔ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BRCA2 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;"> ✔ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> CEACAM5 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;"> ✔ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ANXA4 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;"> ✔ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> SERPINE1 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;"> ✔ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> CRABP2 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;"> ✔ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> DNAJC9 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;"> ✔ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> C10orf116 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> GAD1 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> TPX2 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> KGFLP2 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> EGFL6 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> KLK7 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> PBX1 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LIN28B </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> TFF3 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> MUC5B </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> FUT3 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> STC1 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BCL2 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> PAX8 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> GCNT3 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> GPR64 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ADCYAP1R1 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> IGKC </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BRCA1 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> IGJ </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> TFF1 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> MET </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> CYP2C18 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> CYP4B1 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> SLC3A1 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> EPAS1 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> HNF1B </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> IL6 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ATP5G3 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> DKK4 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> SENP8 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> CAPN2 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> C1orf173 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> CPNE8 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> IGFBP1 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> WT1 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> TP53 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> SEMA6A </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> SERPINA5 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ZBED1 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> TSPAN8 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> SCGB1D2 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LGALS4 </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> MAP1LC3A </td>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
</tbody>
</table>

</div>
</div>
</figure>
</div>
</div>
<section id="variable-importance" class="level3" data-number="2.5.1">
<h3 data-number="2.5.1" class="anchored" data-anchor-id="variable-importance"><span class="header-section-number">2.5.1</span> Variable Importance</h3>
<p>Variable importance is calculated using either a model-based approach if it is available, or a permutation-based VI score otherwise. The variable importance scores are averaged across the outer training folds, and then ranked from highest to lowest.</p>
<p>For the sequential and two-step classifiers, we calculate an overall VI rank by taking the cumulative union of genes at each variable importance rank across all sequences, until all genes have been included.</p>
<p>The variable importance measures are:</p>
<ul>
<li><p>Random Forest: impurity measure (Gini index)</p></li>
<li><p>XGBoost: gain (fractional contribution of each feature to the model based on the total gain of the corresponding features’s splits)</p></li>
<li><p>SVM: permutation based p-values</p></li>
<li><p>Multinomial regression: absolute value of estimated coefficients at cross-validated lambda value</p></li>
</ul>
</section>
</section>
<section id="performance-evaluation" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="performance-evaluation"><span class="header-section-number">2.6</span> Performance Evaluation</h2>
<section id="class-metrics" class="level3" data-number="2.6.1">
<h3 data-number="2.6.1" class="anchored" data-anchor-id="class-metrics"><span class="header-section-number">2.6.1</span> Class Metrics</h3>
<p>We use the accuracy, sensitivity, specificity, F1-score, kappa, balanced accuracy, and geometric mean, as class metrics to measure both training and test performance between different workflows. Multiclass extensions of these metrics can be calculated except for F1-score, where we use macro-averaging to obtain an overall metric. Class-specific metrics are calculated by recoding classes into one-vs-all categories for each class.</p>
<section id="accuracy" class="level4" data-number="2.6.1.1">
<h4 data-number="2.6.1.1" class="anchored" data-anchor-id="accuracy"><span class="header-section-number">2.6.1.1</span> Accuracy</h4>
<p>The accuracy is defined as the proportion of correct predictions out of all cases:</p>
<p><span id="eq-accuracy"><span class="math display">\[
\text{accuracy} = \frac{TP}{TP + FP + FN + TN}
\tag{2.2}\]</span></span></p>
</section>
<section id="sensitivity" class="level4" data-number="2.6.1.2">
<h4 data-number="2.6.1.2" class="anchored" data-anchor-id="sensitivity"><span class="header-section-number">2.6.1.2</span> Sensitivity</h4>
<p>Sensitivity is the proportional of correctly predicted positive cases, out of all cases that were truly positive</p>
<p><span id="eq-sens"><span class="math display">\[
\text{sensitivity} = \frac{TP}{TP + FN}
\tag{2.3}\]</span></span></p>
</section>
<section id="specificity" class="level4" data-number="2.6.1.3">
<h4 data-number="2.6.1.3" class="anchored" data-anchor-id="specificity"><span class="header-section-number">2.6.1.3</span> Specificity</h4>
<p>Specificity is the proportional of correctly predicted negative cases, out of all cases that were truly negative.</p>
<p><span id="eq-spec"><span class="math display">\[
\text{specificity} = \frac{TN}{TN + FP}
\tag{2.4}\]</span></span></p>
</section>
<section id="f1-score" class="level4" data-number="2.6.1.4">
<h4 data-number="2.6.1.4" class="anchored" data-anchor-id="f1-score"><span class="header-section-number">2.6.1.4</span> F1-Score</h4>
<p>The F-measure can be thought of as a harmonic mean between precision and recall:</p>
<p><span id="eq-f1"><span class="math display">\[
F_{meas} = \frac{(1 + \beta^2) \times precision \times recall}{(\beta^2 \times precision) + recall}
\tag{2.5}\]</span></span></p>
<p>The <span class="math inline">\(\beta\)</span> value can be adjusted to place more weight upon precision or recall. The most common value is <span class="math inline">\(\beta\)</span> is 1, which is also commonly known as the F1-score. A multiclass extension doesn’t exist for the F1-score, so we use macro-averaging to calculate this metric when there are more than two classes. For example, with <span class="math inline">\(k\)</span> classes, the macro-averaged F1-score is equal to:</p>
<p><span id="eq-f1-macro"><span class="math display">\[
{F_1}_{macro} = \frac{1}{k} \sum_{i=1}^{k}{F_1}_{i}
\tag{2.6}\]</span></span></p>
<p>where each <span class="math inline">\({F_1}_{i}\)</span> is the F1-score computed frrom recoding classes into <span class="math inline">\(k=i\)</span> vs.&nbsp;<span class="math inline">\(k \neq i\)</span>.</p>
<p>In situations where there is not at least one predicted case for each of the classes (e.g.&nbsp;for a poor classifier), <span class="math inline">\({F_1}_{i}\)</span> is undefined because the per-class precision of class <span class="math inline">\(i\)</span> is undefined. Those <span class="math inline">\({F_1}_{i}\)</span> terms are removed from the <span class="math inline">\({F_1}_{macro}\)</span> equation and the resulting value may be inflated. Interpreting the F1-score in such a case would be misleading.</p>
</section>
<section id="balanced-accuracy" class="level4" data-number="2.6.1.5">
<h4 data-number="2.6.1.5" class="anchored" data-anchor-id="balanced-accuracy"><span class="header-section-number">2.6.1.5</span> Balanced Accuracy</h4>
<p>Balanced accuracy is the arithmetic mean of sensitivity and specificity.</p>
<p><span id="eq-bal-accuracy"><span class="math display">\[
\text{Balanced Accuracy} = \frac{\text{Sensitivity} + \text{Specificity}}{2}
\tag{2.7}\]</span></span></p>
</section>
<section id="kappa" class="level4" data-number="2.6.1.6">
<h4 data-number="2.6.1.6" class="anchored" data-anchor-id="kappa"><span class="header-section-number">2.6.1.6</span> Kappa</h4>
<p>Kappa is the defined as:</p>
<p><span id="eq-kappa"><span class="math display">\[
\text{kappa} = \frac{p_0 - p_e}{1 - p_e}
\tag{2.8}\]</span></span></p>
<p>where <span class="math inline">\(p_0\)</span> is the observed agreement among raters and <span class="math inline">\(p_e\)</span> is the hypothetical probability of agreement due to random chance.</p>
</section>
</section>
<section id="auc" class="level3" data-number="2.6.2">
<h3 data-number="2.6.2" class="anchored" data-anchor-id="auc"><span class="header-section-number">2.6.2</span> AUC</h3>
<p>The area under the receiver operating curve (AUC) is calculated by adding up the area under the curve formed by plotting sensitivity vs.&nbsp;1 - specificity. The Hand-till method is used as a multiclass extension for the AUC.</p>
<p>We did not use AUC to measure class-specific training set performance because combining predicted probabilities in a one-vs-all fashion might be potentially misleading. The sum of probabilities that add up to the “other” class is not equivalent to the predicted probability of the “other” class when using a multiclass classifier.</p>
<p>Instead, we only reported ROC curves and their associated AUCs for the test set performance of the sequential and two-step algorithms.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-talhouk2016" class="csl-entry" role="listitem">
Talhouk, Aline, Stefan Kommoss, Robertson Mackenzie, Martin Cheung, Samuel Leung, Derek S. Chiu, Steve E. Kalloger, et al. 2016. <span>“Single-Patient Molecular Testing with NanoString nCounter Data Using a Reference-Based Strategy for Batch Effect Correction.”</span> Edited by Benjamin Haibe-Kains. <em>PLOS ONE</em> 11 (4): e0153844. <a href="https://doi.org/10.1371/journal.pone.0153844">https://doi.org/10.1371/journal.pone.0153844</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../rsf/introduction.html" class="pagination-link" aria-label="Introduction">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../rsf/distributions.html" class="pagination-link" aria-label="Distributions">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Distributions</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TalhoukLab/OV_Histotypes/edit/main/rsf/methods.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TalhoukLab/OV_Histotypes/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>