# Results

```{r setup-04}
# Load packages and data
library(dplyr)
library(ggplot2)
library(forcats)
library(magrittr)
ivs1 <- readRDS(here::here("data/iv_summary_cs1_all.rds"))
ivs2 <- readRDS(here::here("data/iv_summary_cs2_all.rds"))
ivst <- readRDS(here::here("data/iv_summary_train.rds"))
```

We show internal validation summaries for the combined classifier training set, as well as the CS1 and CS2 sets with duplicates included. The F1-scores, kappa, and G-mean are the measures of interest. Algorithms are sorted by descending value based on the overall F1-score of the training set. The point ranges show the median, 5th and 95th percentiles, coloured by subsampling methods.

## Training Set

### F1-Score

```{r train-f1, fig.cap='Training Set F1-Score'}
ivst_f1 <- ivst %>%
  filter(measure == "macro_f1") %>%
  mutate(
    sampling = fct_inorder(sampling),
    algorithm = fct_reorder2(algorithm, sampling, percentile_50)
  )
alg_levels <- levels(ivst_f1[["algorithm"]])

p <-
  ggplot(ivst_f1, aes(x = algorithm, y = percentile_50, color = sampling)) +
  geom_pointrange(aes(ymin = percentile_5, ymax = percentile_95),
                  position = position_dodge(width = 0.4)) +
  theme_bw() +
  theme(plot.title = element_text(face = "bold")) +
  labs(
    x = "Algorithm",
    y = "F1-Score",
    color = "Subsampling",
    title = "Training Set Macro-Averaged F1-Score by Algorithm and Subsampling Method"
  )
print(p)
```

```{r train-f1-class, fig.cap='Training Set Class-Specific F1-Score'}
ivst_f1_class <- ivst %>%
  filter(grepl("f1\\.", measure)) %>%
  mutate(
    measure = gsub("f1\\.", "", measure),
    sampling = fct_inorder(sampling),
    algorithm = factor(algorithm, levels = alg_levels)
  )

p <-
  ggplot(ivst_f1_class, aes(x = algorithm, y = percentile_50, color = sampling)) +
  geom_pointrange(aes(ymin = percentile_5, ymax = percentile_95),
                  position = position_dodge(width = 0.8)) +
  theme_bw() +
  theme(plot.title = element_text(face = "bold")) +
  facet_wrap(vars(measure), ncol = 2) +
  labs(
    x = "Algorithm",
    y = "F1-Score",
    color = "Subsampling",
    title = "Training Set Class-Specific F1-Score by Algorithm and Subsampling Method"
  )
print(p)
```

### Kappa

```{r train-kappa, fig.cap='Training Set Kappa'}
ivst_kappa <- ivst %>%
  filter(measure == "kappa") %>%
  mutate(
    sampling = fct_inorder(sampling),
    algorithm = factor(algorithm, levels = alg_levels)
  )

p <-
  ggplot(ivst_kappa, aes(x = algorithm, y = percentile_50, color = sampling)) +
  geom_pointrange(aes(ymin = percentile_5, ymax = percentile_95),
                  position = position_dodge(width = 0.4)) +
  theme_bw() +
  theme(plot.title = element_text(face = "bold")) +
  labs(
    x = "Algorithm",
    y = "Kappa",
    color = "Subsampling",
    title = "Training Set Kappa by Algorithm and Subsampling Method"
  )
print(p)
```

```{r train-kappa-class, fig.cap='Training Set Class-Specific Kappa'}
ivst_kappa_class <- ivst %>%
  filter(grepl("kappa\\.", measure)) %>%
  mutate(
    measure = gsub("kappa\\.", "", measure),
    sampling = fct_inorder(sampling),
    algorithm = factor(algorithm, levels = alg_levels)
  )

p <-
  ggplot(ivst_kappa_class, aes(x = algorithm, y = percentile_50, color = sampling)) +
  geom_pointrange(aes(ymin = percentile_5, ymax = percentile_95),
                  position = position_dodge(width = 0.8)) +
  theme_bw() +
  theme(plot.title = element_text(face = "bold")) +
  facet_wrap(vars(measure), ncol = 2) +
  labs(
    x = "Algorithm",
    y = "Kappa",
    color = "Subsampling",
    title = "Training Set Class-Specific Kappa by Algorithm and Subsampling Method"
  )
print(p)
```

### G-mean

```{r train-gmean, fig.cap='Training Set G-mean'}
ivst_gmean <- ivst %>%
  filter(measure == "gmean") %>%
  mutate(
    sampling = fct_inorder(sampling),
    algorithm = factor(algorithm, levels = alg_levels)
  )

p <-
  ggplot(ivst_gmean, aes(x = algorithm, y = percentile_50, color = sampling)) +
  geom_pointrange(aes(ymin = percentile_5, ymax = percentile_95),
                  position = position_dodge(width = 0.4)) +
  theme_bw() +
  theme(plot.title = element_text(face = "bold")) +
  labs(
    x = "Algorithm",
    y = "G-mean",
    color = "Subsampling",
    title = "Training Set G-mean by Algorithm and Subsampling Method"
  )
print(p)
```

```{r train-gmean-class, fig.cap='Training Set Class-Specific G-mean'}
ivst_gmean_class <- ivst %>%
  filter(grepl("gmean\\.", measure)) %>%
  mutate(
    measure = gsub("gmean\\.", "", measure),
    sampling = fct_inorder(sampling),
    algorithm = factor(algorithm, levels = alg_levels)
  )

p <-
  ggplot(ivst_gmean_class, aes(x = algorithm, y = percentile_50, color = sampling)) +
  geom_pointrange(aes(ymin = percentile_5, ymax = percentile_95),
                  position = position_dodge(width = 0.4)) +
  theme_bw() +
  theme(plot.title = element_text(face = "bold")) +
  facet_wrap(vars(measure), ncol = 2) +
  labs(
    x = "Algorithm",
    y = "G-mean",
    color = "Subsampling",
    title = "Training Set Class Specific G-mean by Algorithm and Subsampling Method"
  )
print(p)
```

## CS1 Set

### F1-Score

```{r cs1-f1, fig.cap='CS1 Set F1-Score'}
ivs1_f1 <- ivs1 %>%
  filter(measure == "macro_f1") %>%
  mutate(
    sampling = fct_inorder(sampling),
    algorithm = factor(algorithm, levels = alg_levels)
  )

p <-
  ggplot(ivs1_f1, aes(x = algorithm, y = percentile_50, color = sampling)) +
  geom_pointrange(aes(ymin = percentile_5, ymax = percentile_95),
                  position = position_dodge(width = 0.4)) +
  theme_bw() +
  theme(plot.title = element_text(face = "bold")) +
  labs(
    x = "Algorithm",
    y = "F1-Score",
    color = "Subsampling",
    title = "CS1 Set Macro-Averaged F1-Score by Algorithm and Subsampling Method"
  )
print(p)
```

```{r cs1-f1-class, fig.cap='CS1 Set Class-Specific F1-Score'}
ivs1_f1_class <- ivs1 %>%
  filter(grepl("f1\\.", measure)) %>%
  mutate(
    measure = gsub("f1\\.", "", measure),
    sampling = fct_inorder(sampling),
    algorithm = factor(algorithm, levels = alg_levels)
  )

p <-
  ggplot(ivs1_f1_class, aes(x = algorithm, y = percentile_50, color = sampling)) +
  geom_pointrange(aes(ymin = percentile_5, ymax = percentile_95),
                  position = position_dodge(width = 0.8)) +
  theme_bw() +
  theme(plot.title = element_text(face = "bold")) +
  facet_wrap(vars(measure), ncol = 2) +
  labs(
    x = "Algorithm",
    y = "F1-Score",
    color = "Subsampling",
    title = "CS1 Set Class-Specific F1-Score by Algorithm and Subsampling Method"
  )
print(p)
```

### Kappa

```{r cs1-kappa, fig.cap='CS1 Set Kappa'}
ivs1_kappa <- ivs1 %>%
  filter(measure == "kappa") %>%
  mutate(
    sampling = fct_inorder(sampling),
    algorithm = factor(algorithm, levels = alg_levels)
  )

p <-
  ggplot(ivs1_kappa, aes(x = algorithm, y = percentile_50, color = sampling)) +
  geom_pointrange(aes(ymin = percentile_5, ymax = percentile_95),
                  position = position_dodge(width = 0.4)) +
  theme_bw() +
  theme(plot.title = element_text(face = "bold")) +
  labs(
    x = "Algorithm",
    y = "Kappa",
    color = "Subsampling",
    title = "CS1 Set Kappa by Algorithm and Subsampling Method"
  )
print(p)
```

```{r cs1-kappa-class, fig.cap='CS1 Set Class-Specific Kappa'}
ivs1_kappa_class <- ivs1 %>%
  filter(grepl("kappa\\.", measure)) %>%
  mutate(
    measure = gsub("kappa\\.", "", measure),
    sampling = fct_inorder(sampling),
    algorithm = factor(algorithm, levels = alg_levels)
  )

p <-
  ggplot(ivs1_kappa_class, aes(x = algorithm, y = percentile_50, color = sampling)) +
  geom_pointrange(aes(ymin = percentile_5, ymax = percentile_95),
                  position = position_dodge(width = 0.8)) +
  theme_bw() +
  theme(plot.title = element_text(face = "bold")) +
  facet_wrap(vars(measure), ncol = 2) +
  labs(
    x = "Algorithm",
    y = "Kappa",
    color = "Subsampling",
    title = "CS1 Set Class-Specific Kappa by Algorithm and Subsampling Method"
  )
print(p)
```

### G-mean

```{r cs1-gmean, fig.cap='CS1 Set G-mean'}
ivs1_gmean <- ivs1 %>%
  filter(measure == "gmean") %>%
  mutate(
    sampling = fct_inorder(sampling),
    algorithm = factor(algorithm, levels = alg_levels)
  )

p <-
  ggplot(ivs1_gmean, aes(x = algorithm, y = percentile_50, color = sampling)) +
  geom_pointrange(aes(ymin = percentile_5, ymax = percentile_95),
                  position = position_dodge(width = 0.4)) +
  theme_bw() +
  theme(plot.title = element_text(face = "bold")) +
  labs(
    x = "Algorithm",
    y = "G-mean",
    color = "Subsampling",
    title = "CS1 Set G-mean by Algorithm and Subsampling Method"
  )
print(p)
```

```{r cs1-gmean-class, fig.cap='CS1 Set Class-Specific G-mean'}
ivs1_gmean_class <- ivs1 %>%
  filter(grepl("gmean\\.", measure)) %>%
  mutate(
    measure = gsub("gmean\\.", "", measure),
    sampling = fct_inorder(sampling),
    algorithm = factor(algorithm, levels = alg_levels)
  )

p <-
  ggplot(ivs1_gmean_class, aes(x = algorithm, y = percentile_50, color = sampling)) +
  geom_pointrange(aes(ymin = percentile_5, ymax = percentile_95),
                  position = position_dodge(width = 0.4)) +
  theme_bw() +
  theme(plot.title = element_text(face = "bold")) +
  facet_wrap(vars(measure), ncol = 2) +
  labs(
    x = "Algorithm",
    y = "G-mean",
    color = "Subsampling",
    title = "CS1 Set Class Specific G-mean by Algorithm and Subsampling Method"
  )
print(p)
```

## CS2 Set

### F1-Score

```{r cs2-f1, fig.cap='CS2 Set F1-Score'}
ivs2_f1 <- ivs2 %>%
  filter(measure == "macro_f1") %>%
  mutate(
    sampling = fct_inorder(sampling),
    algorithm = factor(algorithm, levels = alg_levels)
  )

p <-
  ggplot(ivs2_f1, aes(x = algorithm, y = percentile_50, color = sampling)) +
  geom_pointrange(aes(ymin = percentile_5, ymax = percentile_95),
                  position = position_dodge(width = 0.4)) +
  theme_bw() +
  theme(plot.title = element_text(face = "bold")) +
  labs(
    x = "Algorithm",
    y = "F1-Score",
    color = "Subsampling",
    title = "CS2 Set Macro-Averaged F1-Score by Algorithm and Subsampling Method"
  )
print(p)
```

```{r cs2-f1-class, fig.cap='CS2 Set Class-Specific F1-Score'}
ivs2_f1_class <- ivs2 %>%
  filter(grepl("f1\\.", measure)) %>%
  mutate(
    measure = gsub("f1\\.", "", measure),
    sampling = fct_inorder(sampling),
    algorithm = factor(algorithm, levels = alg_levels)
  )

p <-
  ggplot(ivs2_f1_class, aes(x = algorithm, y = percentile_50, color = sampling)) +
  geom_pointrange(aes(ymin = percentile_5, ymax = percentile_95),
                  position = position_dodge(width = 0.8)) +
  theme_bw() +
  theme(plot.title = element_text(face = "bold")) +
  facet_wrap(vars(measure), ncol = 2) +
  labs(
    x = "Algorithm",
    y = "F1-Score",
    color = "Subsampling",
    title = "CS2 Set Class-Specific F1-Score by Algorithm and Subsampling Method"
  )
print(p)
```

### Kappa

```{r cs2-kappa, fig.cap='CS2 Set Kappa'}
ivs2_kappa <- ivs2 %>%
  filter(measure == "kappa") %>%
  mutate(
    sampling = fct_inorder(sampling),
    algorithm = factor(algorithm, levels = alg_levels)
  )

p <-
  ggplot(ivs2_kappa, aes(x = algorithm, y = percentile_50, color = sampling)) +
  geom_pointrange(aes(ymin = percentile_5, ymax = percentile_95),
                  position = position_dodge(width = 0.4)) +
  theme_bw() +
  theme(plot.title = element_text(face = "bold")) +
  labs(
    x = "Algorithm",
    y = "Kappa",
    color = "Subsampling",
    title = "CS2 Set Kappa by Algorithm and Subsampling Method"
  )
print(p)
```

```{r cs2-kappa-class, fig.cap='CS2 Set Class-Specific Kappa'}
ivs2_kappa_class <- ivs2 %>%
  filter(grepl("kappa\\.", measure)) %>%
  mutate(
    measure = gsub("kappa\\.", "", measure),
    sampling = fct_inorder(sampling),
    algorithm = factor(algorithm, levels = alg_levels)
  )

p <-
  ggplot(ivs2_kappa_class, aes(x = algorithm, y = percentile_50, color = sampling)) +
  geom_pointrange(aes(ymin = percentile_5, ymax = percentile_95),
                  position = position_dodge(width = 0.8)) +
  theme_bw() +
  theme(plot.title = element_text(face = "bold")) +
  facet_wrap(vars(measure), ncol = 2) +
  labs(
    x = "Algorithm",
    y = "Kappa",
    color = "Subsampling",
    title = "CS2 Set Class-Specific Kappa by Algorithm and Subsampling Method"
  )
print(p)
```

### G-mean

```{r cs2-gmean, fig.cap='CS2 Set G-mean'}
ivs2_gmean <- ivs2 %>%
  filter(measure == "gmean") %>%
  mutate(
    sampling = fct_inorder(sampling),
    algorithm = factor(algorithm, levels = alg_levels)
  )

p <-
  ggplot(ivs2_gmean, aes(x = algorithm, y = percentile_50, color = sampling)) +
  geom_pointrange(aes(ymin = percentile_5, ymax = percentile_95),
                  position = position_dodge(width = 0.4)) +
  theme_bw() +
  theme(plot.title = element_text(face = "bold")) +
  labs(
    x = "Algorithm",
    y = "G-mean",
    color = "Subsampling",
    title = "CS2 Set G-mean by Algorithm and Subsampling Method"
  )
print(p)
```

```{r cs2-gmean-class, fig.cap='CS2 Set Class-Specific G-mean'}
ivs2_gmean_class <- ivs2 %>%
  filter(grepl("gmean\\.", measure)) %>%
  mutate(
    measure = gsub("gmean\\.", "", measure),
    sampling = fct_inorder(sampling),
    algorithm = factor(algorithm, levels = alg_levels)
  )

p <-
  ggplot(ivs2_gmean_class, aes(x = algorithm, y = percentile_50, color = sampling)) +
  geom_pointrange(aes(ymin = percentile_5, ymax = percentile_95),
                  position = position_dodge(width = 0.4)) +
  theme_bw() +
  theme(plot.title = element_text(face = "bold")) +
  facet_wrap(vars(measure), ncol = 2) +
  labs(
    x = "Algorithm",
    y = "G-mean",
    color = "Subsampling",
    title = "CS2 Set Class Specific G-mean by Algorithm and Subsampling Method"
  )
print(p)
```
